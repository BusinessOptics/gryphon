{% extends "template.html" %}
{% block title %}Task Definitions Overview{% endblock %}
{% block scripts %}
<script src="/static/js/picoModal.js"></script>
<script>

    function run(image_name, env){
        envVariables = "";
        Object.keys(env).forEach(function(key,index) {
            envVariables = envVariables + "-e " + key + "=" + env[key] + " ";
        });

        var command = "docker run -it -u root " + envVariables + image_name + " bash";

        picoModal({
            content: '<pre><textarea style="width:100%; height:10em;">'+command+'</textarea></pre>',
            width: '50%'
        }).afterClose(function (modal) { modal.destroy(); }).show();
    }

    function hideElements(name){
        parent = document.getElementById(name);
        children = parent.children;
        var i;
        for (i = 0; i < children.length; i++) {
            if(!children[i].classList.contains("skip")){
                children[i].style.display = "none";
            }
            if(children[i].classList.contains("action")){
                button = children[i];
            }
        }
        button.innerHTML = "show";
        button.onclick = function(){ showElements(name); };
    }

    function showElements(name){
        parent = document.getElementById(name);
        children = parent.children;
        var button;
        var i;
        for (i = 0; i < children.length; i++) {
            if(!children[i].classList.contains("skip")){
                children[i].style.display = "block";
            }
            if(children[i].classList.contains("action")){
                button = children[i];
            }
        }
        button.innerHTML = "hide";
        button.onclick = function(){ hideElements(name); };
    }

</script>
{% endblock %}
{% block body %}
<div class='header'>
    {% set link = 'https://console.aws.amazon.com/ecs/home?region=us-east-1#/taskDefinitions' %}
    {% include "consolebutton.html" %}
    <a
            class='action'
            target='_blank'
            href='../../'>index</a>
    <h1>Task Definitions Overview</h1>
</div>
<div class='overview'>
    <div class="task-definition-container">
        <h2>Task Definitions</h2>
        {% for family in task_definitions %}
        <div class="task-definition" id="{{family}}" >
            {% set link = 'https://console.aws.amazon.com/ecs/home?region=us-east-1#/taskDefinitions/'~family.name %}
            {% include "consolebutton.html" %}
            <p class="action skip" onclick="showElements('{{family}}')">show</p>
            <h2  class="skip">{{family.name}}</h2>
            {% for task_def in family.task_defs %}
                <div class="task none">
                    {% set link = 'https://console.aws.amazon.com/ecs/home?region=us-east-1#/taskDefinitions/'~family.name~'/'~task_def.revision %}
                    {% include "consolebutton.html" %}
                    {% set container_def = task_def.container_defs[0] %}
                    {% include "runbutton.html" %}
                    {{family.name}} - {{task_def.revision}}
                </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

</div>
{% endblock %}